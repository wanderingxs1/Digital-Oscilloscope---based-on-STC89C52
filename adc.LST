C51 COMPILER V9.00   ADC                                                                   04/06/2023 21:44:02 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ADC
OBJECT MODULE PLACED IN adc.OBJ
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE adc.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<adc.h>
   2          
   3          extern char ADC_RESULT;
   4          extern char DAC_VALUE;
   5          extern char workMode;
   6          
   7          unsigned int channalSelect=0x0000;//DAC通道选择
   8          
   9          void adc_init()
  10          {
  11   1          P1ASF=0x08;     //确定p13是a-d功能,输入
  12   1              //开AD电源，速度设置最慢，清零一次AD开始位和AD完成位，选择P1^3作为AD输入端口
  13   1          ADC_CONTR=ADC_INIT;
  14   1          delay(2);
  15   1      }
  16          
  17          
  18          
  19          void ad_start()         //adc放在定时器中断里边，采样频率为4000Hz。
  20          {
  21   1              //启动一次AD转换，然后等待转换结束。ADC中断是低优先级
  22   1              ADC_CONTR=ADC_START;
  23   1      
  24   1              //这段时间刚好用来做DAC,把DA结果输出
  25   1              channalSelect=CH1;
  26   1              dac_work(channalSelect);
  27   1      
  28   1      }
  29          
  30          
  31          void dac_work(int channalSelect){
  32   1              XBYTE[channalSelect]=DAC_VALUE; 
  33   1      }
  34          
  35          void adc_work() interrupt 5
  36          {
  37   1              //ADC_START转换结束后自动置0
  38   1              //ADC_FLAG转换结束后为1,需要手动清零
  39   1              ADC_CONTR=ADC_INIT;
  40   1      
  41   1              //把AD结果存储
  42   1              //问题:ADC转换值是1024个阶,DAC转换值是256个阶,要进行转换,舍去最低两位
  43   1              ADC_RESULT=ADC_RES;
  44   1      
  45   1              //工作模式1实时输出AD结果,并储存
  46   1              //工作模式2实时输出结果
  47   1              switch(workMode){
  48   2              case 1:DAC_VALUE=ADC_RESULT;break;
  49   2              case 2:DAC_VALUE=ADC_RESULT;break;
  50   2              default:break;
  51   2              }
  52   1      
  53   1              ADC_RES=0;
  54   1      }
  55          
C51 COMPILER V9.00   ADC                                                                   04/06/2023 21:44:02 PAGE 2   

  56          void delay(int delayTime)
  57          {
  58   1              unsigned int x;
  59   1              while(delayTime--){
  60   2              x=5000;
  61   2              while(x--);
  62   2              }
  63   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     94    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
