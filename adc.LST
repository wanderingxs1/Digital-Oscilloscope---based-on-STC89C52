C51 COMPILER V9.00   ADC                                                                   04/13/2023 19:14:56 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ADC
OBJECT MODULE PLACED IN adc.OBJ
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE adc.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<adc.h>
   2          
   3          extern char ADC_RESULT;
   4          extern char DAC_VALUE;
   5          extern char workMode;
   6          extern char WAVE_VALUE;
   7          extern char OUTPUT_VALUE;
   8          
   9          unsigned int channalSelect=0x0000;//DACé€šé“é€‰æ‹©
  10          
  11          void adc_init()
  12          {
  13   1          P1ASF=0x08;     //ç¡®å®šp13æ˜¯a-dåŠŸèƒ½,è¾“å…¥
  14   1              //å¼€ADç”µæºï¼Œé€Ÿåº¦è®¾ç½®æœ€æ…¢ï¼Œæ¸…é›¶ä¸€æ¬¡ADå¼€å§‹ä½å’ŒADå®Œæˆä½ï¼Œé€‰æ‹©P1^3ä½œä¸ºADè¾“å…¥ç«¯å
             -£
  15   1          ADC_CONTR=ADC_INIT;
  16   1          delay(2);
  17   1      }
  18          
  19          
  20          
  21          void adc_start()                //adcæ”¾åœ¨å®šæ—¶å™¨ä¸­æ–­é‡Œè¾¹ï¼Œé‡‡æ ·é¢‘ç‡ä¸º4000Hzã€‚
  22          {
  23   1              //å¯åŠ¨ä¸€æ¬¡ADè½¬æ¢ï¼Œç„¶åç­‰å¾…è½¬æ¢ç»“æŸã€‚ADCä¸­æ–­æ˜¯ä½ä¼˜å…ˆçº§
  24   1              ADC_CONTR=ADC_START;
  25   1      
  26   1              //è¿™æ®µæ—¶é—´åˆšå¥½ç”¨æ¥åšDAC,æŠŠDAç»“æœè¾“å‡º
  27   1          switch(workMode){
  28   2              case 1:
  29   2                      channalSelect=CH1;
  30   2              dac_work(channalSelect,DAC_VALUE);
  31   2                      channalSelect=CH2;
  32   2              dac_work(channalSelect,WAVE_VALUE);
  33   2              break;
  34   2              case 2:
  35   2                      channalSelect=CH1;
  36   2              dac_work(channalSelect,DAC_VALUE);
  37   2                      channalSelect=CH2;
  38   2              dac_work(channalSelect,OUTPUT_VALUE);
  39   2              break;
  40   2              case 3:
  41   2                      channalSelect=CH1;
  42   2              dac_work(channalSelect,DAC_VALUE);
  43   2                      channalSelect=CH2;
  44   2              dac_work(channalSelect,0x00);
  45   2              break;
  46   2              default:break;
  47   2          }
  48   1      
  49   1      
  50   1      }
  51          
  52          
  53          void dac_work(int channalSelect,char value){
  54   1              XBYTE[channalSelect]=value;     
C51 COMPILER V9.00   ADC                                                                   04/13/2023 19:14:56 PAGE 2   

  55   1      }
  56          
  57          void adc_work() interrupt 5
  58          {
  59   1              //ADC_STARTè½¬æ¢ç»“æŸåè‡ªåŠ¨ç½®0
  60   1              //ADC_FLAGè½¬æ¢ç»“æŸåä¸º1,éœ€è¦æ‰‹åŠ¨æ¸…é›¶
  61   1              ADC_CONTR=ADC_INIT;
  62   1      
  63   1              //æŠŠADç»“æœå­˜å‚¨
  64   1              //é—®é¢˜:ADCè½¬æ¢å€¼æ˜¯1024ä¸ªé˜¶,DACè½¬æ¢å€¼æ˜¯256ä¸ªé˜¶,è¦è¿›è¡Œè½¬æ¢,èˆå»æœ€ä½ä¸¤ä½
  65   1              ADC_RESULT=ADC_RES;
  66   1      }
  67          
  68          void delay(int delayTime)
  69          {
  70   1              unsigned int x;
  71   1              while(delayTime--){
  72   2              x=1000;
  73   2              while(x--);
  74   2              }
  75   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    123    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
