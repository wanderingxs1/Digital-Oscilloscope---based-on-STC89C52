C51 COMPILER V9.00   KEY                                                                   04/28/2023 11:39:55 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN key.OBJ
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE key.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<key.h>
   2          //按键延时消除抖动，很重要！避免一次操作被误判为多次
   3          extern char workMode;
   4          extern char key_num;
   5          extern char waveMode;
   6          extern char key_sta;
   7          extern char isChange;//是准备调频/调幅，改变按钮5678的用途
   8          extern char freBuffer;
   9          extern char ampBuffer;
  10          sbit KEY1      = P3^4;
  11          sbit KEY2      = P3^5;
  12          
  13          
  14          void key_service()
  15            {
  16   1        if(key_sta&0x01) return;             // key_sta.0=1?????????????????￡???????????
  17   1         if(KEY2)                             //???μ???????
  18   1              {
  19   2          key_num=key_num+1;                  //????????????0-4???????м?????????1-8??  
  20   2              key_sta=key_sta|0x01;              // ??key_sta.0=1
  21   2              }
  22   1         else if(KEY1)
  23   1                {
  24   2                    key_num=key_num+5;   
  25   2                key_sta=key_sta|0x01;        // ??key_sta.0=1
  26   2                    }
  27   1        }
  28          
  29          void keyWork()
  30          {
  31   1              switch(key_num)
  32   1              {
  33   2              //123号按键改变工作模式
  34   2                  case 1:
  35   2                      workMode=key_num;
  36   2                  break;
  37   2                  case 2:
  38   2                      workMode=key_num;
  39   2                  break;
  40   2                  case 3:
  41   2                      workMode=key_num;
  42   2                  break;
  43   2              //4号按键改变工作模式1下,是否进行频率和幅度的调整，相关变量isChange
  44   2                  case 4:
  45   2                      if(workMode==1){
  46   3                          if(isChange==0){
  47   4                                              isChange=1;//开始调频调幅
  48   4                              }
  49   3                          else{
  50   4                                              isChange=0;
  51   4                                              freBuffer=0;
  52   4                                              ampBuffer=1;
  53   4                          }
  54   3                      }
  55   2                              delay(20);
C51 COMPILER V9.00   KEY                                                                   04/28/2023 11:39:55 PAGE 2   

  56   2                  break;
  57   2      //5678号按键适用于在工作模式1下改变输出波形
  58   2                  case 5:
  59   2                      if(workMode==1){
  60   3                                      if(!isChange){
  61   4                                              waveMode=1;
  62   4                                      }
  63   3                                      else{
  64   4                                              if(freBuffer>=1){
  65   5                                                      freBuffer=freBuffer-1;
  66   5                                              }
  67   4                                      }
  68   3                  }
  69   2                              delay(20);
  70   2              break;
  71   2              case 6:
  72   2                  if(workMode==1){
  73   3                                      if(!isChange){
  74   4                                              waveMode=2;
  75   4                                      }
  76   3                                      else{
  77   4                                              freBuffer=freBuffer+1;
  78   4                                      }
  79   3                  }
  80   2                              delay(20);
  81   2              break;
  82   2              case 7:
  83   2                  if(workMode==1){
  84   3                                      if(!isChange){
  85   4                                              waveMode=3;
  86   4                                      }
  87   3                                      else{
  88   4                                              if(ampBuffer>=2){
  89   5                                                      ampBuffer=ampBuffer-1;
  90   5                                              }
  91   4                                      }
  92   3                  }
  93   2                              delay(30);
  94   2              break;
  95   2              case 8:
  96   2                  if(workMode==1){
  97   3                                      if(!isChange){
  98   4                                              waveMode=4;
  99   4                                      }
 100   3                                      else{
 101   4                                              ampBuffer=ampBuffer+1;
 102   4                                      }
 103   3                  }
 104   2                              delay(30);
 105   2              break;
 106   2              default:
 107   2              break;
 108   2      
 109   2              }
 110   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    204    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.00   KEY                                                                   04/28/2023 11:39:55 PAGE 3   

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
