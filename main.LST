C51 COMPILER V9.00   MAIN                                                                  04/06/2023 21:44:02 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<main.h>
   2          #include<adc.h>
   3          //---------------------------------------------------------------------------------------
   4          void init_timer0(void)              //  ¶¨Ê±Æ÷0³õÊ¼
   5            {
   6   1        TMOD &= 0XF0;
   7   1        TMOD |= 0X02;    //8Î»ÖØÔØ¶¨Ê±Æ÷t0
   8   1        TL0 = 0X06;
   9   1        TH0 = 0X06;      //Ò»¸ö¼ÆÊýÖÜÆÚ0.25ms
  10   1        TR0 = 1;
  11   1        }
  12          //---------------------------------------------------------------------------------------
  13          void init_special_interrupts(void)   //  ÖÐ¶ÏÉèÖÃ
  14            {
  15   1        //Á½¸öÖÐ¶ÏÅäÖÃ
  16   1        EA  = 1;              //×ÜÖÐ¶Ï
  17   1        ET0 = 1;              //ÔÊÐíT0ÖÐ¶Ï
  18   1        EADC=1;               //ÔÊÐíADÖÐ¶Ï
  19   1        //ÖÐ¶ÏÓÅÏÈ¼¶ÅäÖÃ
  20   1        PT0 = 1;
  21   1        PADC=0;
  22   1        }
  23          //---------------------------------------------------------------------------------------
  24          void dsptask()
  25            {
  26   1        unsigned char i;
  27   1        unsigned char a,b;
  28   1      
  29   1        switch(sel)
  30   1         {
  31   2         case 0:  a=0x01;  break;
  32   2         case 1:  a=0x02;  break;
  33   2         case 2:  a=0x04;  break;
  34   2         default: a=0x08;
  35   2         }
  36   1       for(b=0x80,i=0;i<8;i++)
  37   1          {
  38   2          if(a&b)  D_SER=1;
  39   2          else     D_SER=0;
  40   2          D_SRCLK=0;
  41   2          D_SRCLK=1;
  42   2          D_SRCLK=0;
  43   2          b=b>>1;  b=b&0x7f;
  44   2          }
  45   1        a=dspbuf[sel];
  46   1        sel++;
  47   1        if(sel>=4) sel=0;
  48   1        for(b=0x80,i=0;i<8;i++)
  49   1          {
  50   2          if(a&b)  D_SER=1;
  51   2          else     D_SER=0;
  52   2          D_SRCLK=0;
  53   2          D_SRCLK=1;
  54   2          D_SRCLK=0;
  55   2          b=b>>1;  b=b&0x7fff;
C51 COMPILER V9.00   MAIN                                                                  04/06/2023 21:44:02 PAGE 2   

  56   2          }
  57   1        D_RCLK=0;
  58   1        D_RCLK=1;
  59   1        D_RCLK=0;
  60   1        }
  61          //---------------------------------------------------------------------------------------
  62          void timer_isr() interrupt 1           //¶¨Ê±Æ÷0ÖÐ¶Ï´¦Àí
  63            {
  64   1        EA=0;
  65   1        adcount++;
  66   1        adc_start();
  67   1        if(adcount==20)                      // 1/4*20 = 5ms
  68   1          {
  69   2          dsptask();
  70   2          clocktime++;
  71   2          adcount=0;
  72   2          }
  73   1        EA=1;
  74   1        }
  75          //---------------------------------------------------------------------------------------
  76          void fdisp(unsigned char n,unsigned char m)      //¹¦ÄÜÊÇ½«ÒªÐ´ÈëµÄÊýÖµn¶ÔÓ¦µÄÊýÂë¹Ü±àÂë×°ÈëdspbufµÄµÚm¸öµ
             -¥Ôª,Ã»ÓÐÓÃµ½
  77            {
  78   1        char  c;
  79   1         switch(n)
  80   1          {
  81   2          case 0:  c=0x11;  break;
  82   2          case 1:  c=0x7d;  break;
  83   2          case 2:  c=0x23;  break;
  84   2          case 3:  c=0x29;  break;
  85   2          case 4:  c=0x4d;  break;
  86   2          case 5:  c=0x89;  break;
  87   2          case 6:  c=0x81;  break;
  88   2          case 7:  c=0x3d;  break;
  89   2          case 8:  c=0x01;  break;
  90   2          default: c=0x09; 
  91   2          }
  92   1         dspbuf[m]=c;
  93   1        }
  94          //---------------------------------------------------------------------------------------
  95          void main(void)                    // Ö÷º¯Êý
  96            {
  97   1        init_timer0();                  //³õÊ¼»¯¶¨Ê±Æ÷0
  98   1        init_special_interrupts();      //ÉèÖÃÖÐ¶Ï
  99   1        adc_init();                                           //ÉèÖÃADC
 100   1        for(;;)
 101   1          {
 102   2              //Èç¹ûADC¡ª¡ªRESULTµÄÖµºÍÉÏÒ»´Î²»Í¬£¬ÄÇ¾Í¸üÐÂ,¹¹ÔìÁËÒ»¸öÑ­»·ÕóÁÐ
 103   2              if(ad_temp!=ADC_RESULT){
 104   3              if(adAddress<=0x0FFF){
 105   4              XBYTE[adAddress]=ADC_RESULT;
 106   4              ad_temp=ADC_RESULT;
 107   4              }
 108   3              else{
 109   4              adAddress=ADC_BASE_ADDRESS;
 110   4              XBYTE[adAddress]=ADC_RESULT;
 111   4              ad_temp=ADC_RESULT;
 112   4              }
 113   3              }
 114   2          /*
 115   2              if(p_read!=p_write)             //Èç¹ûÓÐ¶ÁÈëÊý¾Ý£¬ÄÇÃ´¾ÍÐ´³öÈ¥(Ö»ÊÇÐ´µ½ÁËDAÊä³öµÄ1ºÅµ¥Ôª)
 116   2                 {
C51 COMPILER V9.00   MAIN                                                                  04/06/2023 21:44:02 PAGE 3   

 117   2              DAC_1=buff[p_read];       // D/AÊä³ö
 118   2                  p_read++;
 119   2                  if(p_read==LEN)  p_read=0;
 120   2              }
 121   2          */
 122   2              }
 123   1        }
 124          //----------------------------------End---------------------------------------------------


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    385    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     20    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
