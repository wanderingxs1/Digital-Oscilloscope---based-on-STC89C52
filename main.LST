C51 COMPILER V9.00   MAIN                                                                  04/12/2023 20:35:58 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<main.h>
   2          #include<adc.h>
   3          //---------------------------------------------------------------------------------------
   4          void init_timer0(void)              //  ¶¨Ê±Æ÷0³õÊ¼
   5            {
   6   1        TMOD &= 0XF0;
   7   1        TMOD |= 0X02;    //8Î»ÖØÔØ¶¨Ê±Æ÷t0
   8   1        TL0 = 0X06;
   9   1        TH0 = 0X06;      //Ò»¸ö¼ÆÊýÖÜÆÚ0.25ms
  10   1        TR0 = 1;
  11   1        }
  12          //---------------------------------------------------------------------------------------
  13          void init_special_interrupts(void)   //  ÖÐ¶ÏÉèÖÃ
  14            {
  15   1        //Á½¸öÖÐ¶ÏÅäÖÃ
  16   1        EA  = 1;              //×ÜÖÐ¶Ï
  17   1        ET0 = 1;              //ÔÊÐíT0ÖÐ¶Ï
  18   1        EADC=1;               //ÔÊÐíADÖÐ¶Ï
  19   1        //ÖÐ¶ÏÓÅÏÈ¼¶ÅäÖÃ
  20   1        PT0 = 1;
  21   1        PADC=0;
  22   1        }
  23          //---------------------------------------------------------------------------------------
  24          void dsptask()
  25            {
  26   1        unsigned char i;
  27   1        unsigned char a,b;
  28   1      
  29   1        switch(sel)
  30   1         {
  31   2         case 0:  a=0x01;  break;
  32   2         case 1:  a=0x02;  break;
  33   2         case 2:  a=0x04;  break;
  34   2         default: a=0x08;
  35   2         }
  36   1       for(b=0x80,i=0;i<8;i++)
  37   1          {
  38   2          if(a&b)  D_SER=1;
  39   2          else     D_SER=0;
  40   2          D_SRCLK=0;
  41   2          D_SRCLK=1;
  42   2          D_SRCLK=0;
  43   2          b=b>>1;  b=b&0x7f;
  44   2          }
  45   1        a=dspbuf[sel];
  46   1        key_num=sel;          //È¡µÃ°´¼üËùÔÚÐÐ£¨¿ÉÄÜµÄÐÐ£©
  47   1        sel++;
  48   1        if(sel>=4) sel=0;
  49   1        for(b=0x80,i=0;i<8;i++)
  50   1          {
  51   2          if(a&b)  D_SER=1;
  52   2          else     D_SER=0;
  53   2          D_SRCLK=0;
  54   2          D_SRCLK=1;
  55   2          D_SRCLK=0;
C51 COMPILER V9.00   MAIN                                                                  04/12/2023 20:35:58 PAGE 2   

  56   2          b=b>>1;  b=b&0x7fff;
  57   2          }
  58   1        D_RCLK=0;
  59   1        D_RCLK=1;
  60   1        D_RCLK=0;
  61   1      
  62   1        //ËÍÈëÆ¬Ñ¡ÐÅºÅ
  63   1        a=0x10;
  64   1        for(b=0x80,i=0;i<8;i++)
  65   1          {
  66   2          if(a&b)  D_SER=1;
  67   2          else     D_SER=0;
  68   2          D_SRCLK=0;
  69   2          D_SRCLK=1;
  70   2          D_SRCLK=0;
  71   2          b=b>>1;  b=b&0x7f;
  72   2          }
  73   1         //Ñ¡ÔñÒªÏÔÊ¾µÄ¹¤×÷Ä£Ê½
  74   1        switch(workMode)
  75   1         {
  76   2         case 0:  a=0xF7;  break;
  77   2         case 1:  a=0xFB;  break;
  78   2         case 2:  a=0xFD;  break;
  79   2         default: a=0x0E;
  80   2         }
  81   1         //°Ñ¹¤×÷Ä£Ê½ËÍ³öÈ¥
  82   1        for(b=0x80,i=0;i<8;i++)
  83   1          {
  84   2          if(a&b)  D_SER=1;
  85   2          else     D_SER=0;
  86   2          D_SRCLK=0;
  87   2          D_SRCLK=1;
  88   2          D_SRCLK=0;
  89   2          b=b>>1;  b=b&0x7fff;
  90   2          }
  91   1        D_RCLK=0;
  92   1        D_RCLK=1;
  93   1        D_RCLK=0;
  94   1        }
  95          //---------------------------------------------------------------------------------------
  96          void timer_isr() interrupt 1           //¶¨Ê±Æ÷0ÖÐ¶Ï´¦Àí
  97            {
  98   1        EA=0;
  99   1        adcount++;
 100   1        adc_start();
 101   1        if(adcount==20)                      // 1/4*20 = 5ms
 102   1          {
 103   2          dsptask();
 104   2          key_service();
 105   2          clocktime++;
 106   2          adcount=0;
 107   2          }
 108   1        EA=1;
 109   1        }
 110          //---------------------------------------------------------------------------------------
 111          void fdisp(unsigned char n,unsigned char m)      //¹¦ÄÜÊÇ½«ÒªÐ´ÈëµÄÊýÖµn¶ÔÓ¦µÄÊýÂë¹Ü±àÂë×°ÈëdspbufµÄµÚm¸öµ
             -¥Ôª,Ã»ÓÐÓÃµ½
 112            {
 113   1        char  c;
 114   1         switch(n)
 115   1          {
 116   2          case 0:  c=0x11;  break;
C51 COMPILER V9.00   MAIN                                                                  04/12/2023 20:35:58 PAGE 3   

 117   2          case 1:  c=0x7d;  break;
 118   2          case 2:  c=0x23;  break;
 119   2          case 3:  c=0x29;  break;
 120   2          case 4:  c=0x4d;  break;
 121   2          case 5:  c=0x89;  break;
 122   2          case 6:  c=0x81;  break;
 123   2          case 7:  c=0x3d;  break;
 124   2          case 8:  c=0x01;  break;
 125   2          default: c=0x09; 
 126   2          }
 127   1         dspbuf[m]=c;
 128   1        }
 129          //---------------------------------------------------------------------------------------
 130          void main(void)                    // Ö÷º¯Êý
 131            {
 132   1        init_timer0();                  //³õÊ¼»¯¶¨Ê±Æ÷0
 133   1        init_special_interrupts();      //ÉèÖÃÖÐ¶Ï
 134   1        adc_init();                                           //ÉèÖÃADC
 135   1        for(;;)
 136   1          {
 137   2      
 138   2        //¹¤×÷Ä£Ê½1²Å»áËæÊ±½øÐÐ´æ´¢
 139   2        if(workMode==1){
 140   3              //Èç¹ûADC¡ª¡ªRESULTµÄÖµºÍÉÏÒ»´Î²»Í¬£¬ÄÇ¾Í¸üÐÂ,¹¹ÔìÁËÒ»¸öÑ­»·ÕóÁÐ
 141   3              if(ad_temp!=ADC_RESULT){
 142   4        daAddress=adAddress;//Í¬²½
 143   4              if(adAddress<=0x0FFF){
 144   5              XBYTE[adAddress]=ADC_RESULT;
 145   5              ad_temp=ADC_RESULT;
 146   5              adAddress++;
 147   5              }
 148   4              else{
 149   5              adAddress=ADC_BASE_ADDRESS;
 150   5              XBYTE[adAddress]=ADC_RESULT;
 151   5              ad_temp=ADC_RESULT;
 152   5          adAddress++;
 153   5              }
 154   4              }
 155   3        }
 156   2      
 157   2        //¹¤×÷Ä£Ê½2½øÐÐch2Êä³ö±äÁ¿OUTPUT_VALUEµÄ¸³Öµ,µ÷µ½¹¤×÷Ä£Ê½2Ò»¶¨ÒÑ¾­²ÉÍêÒ»ÂÖÁË
 158   2        //ÁôÓÐÒ»¸öÎÊÌâ£¬Ìø³ö¹¤×÷Ä£Ê½1ºóadAddress»áÔÚÄÚ´æ¿Õ¼äµÄÄ³Ò»´¦Í£ÏÂ
 159   2        //ÔÝ¶¨Îª´ÓadAddress¿ªÊ¼Ñ­»·Êä³ö
 160   2        if(workMode==2){
 161   3          if(daAddress<=0x0FFF){
 162   4            OUTPUT_VALUE=XBYTE[daAddress];
 163   4            daAddress++;
 164   4          }
 165   3          else{
 166   4            daAddress=ADC_BASE_ADDRESS;
 167   4            OUTPUT_VALUE=XBYTE[daAddress];
 168   4            daAddress++;
 169   4          }
 170   3        }
 171   2      
 172   2        //°´¼ü´¦Àí
 173   2        if(key_sta&0x01)              // key_sta.0==1?£¬ÓÐ°´¼ü°´ÏÂ
 174   2          {             
 175   3                       keyWork();
 176   3               key_sta=key_sta&0xfe;           // ÖÃkey_sta.0=0,¸´Î»
 177   3          } 
 178   2              }
C51 COMPILER V9.00   MAIN                                                                  04/12/2023 20:35:58 PAGE 4   

 179   1        }
 180          //----------------------------------End---------------------------------------------------


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    585    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     29    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
